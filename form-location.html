<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ตรวจสอบตำแหน่งก่อนกรอกฟอร์ม</title>
</head>
<body>
  <h2>ลงทะเบียนในพื้นที่</h2>
  <p id="status">กำลังตรวจสอบตำแหน่งของคุณ...</p>

  <div id="formContainer" style="display:none;">
    <!-- ✅ เปลี่ยนลิงก์ src ให้เป็นของคุณ -->
    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSexzScDffqHToIljjla5OCsrn4y8kEj2JcDuUhIy1HhomuErQ/viewform?embedded=true" width="640" height="800" frameborder="0" marginheight="0" marginwidth="0">กำลังโหลด…</iframe>
  </div>

  <script>
    // ✅ กำหนดพิกัดพื้นที่เป้าหมาย
    const targetLat = 15.377959;  // แก้เป็นของคุณ
    const targetLng = 100.024784; // แก้เป็นของคุณ
    const allowedDistance = 1000; // ระยะอนุญาตในเมตร

    // ฟังก์ชันคำนวณระยะทาง
    function getDistanceFromLatLonInMeters(lat1, lon1, lat2, lon2) {
      const R = 6371e3;
      const φ1 = lat1 * Math.PI/180;
      const φ2 = lat2 * Math.PI/180;
      const Δφ = (lat2-lat1) * Math.PI/180;
      const Δλ = (lon2-lon1) * Math.PI/180;

      const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ/2) * Math.sin(Δλ/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

      return R * c;
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(position => {
        const userLat = position.coords.latitude;
        const userLng = position.coords.longitude;

        const distance = getDistanceFromLatLonInMeters(userLat, userLng, targetLat, targetLng);

        if (distance <= allowedDistance) {
          document.getElementById('status').innerText = "✅ คุณอยู่ในพื้นที่ สามารถกรอกแบบฟอร์มได้";
          document.getElementById('formContainer').style.display = 'block';
        } else {
          document.getElementById('status').innerText = `❌ คุณอยู่นอกพื้นที่ (${Math.round(distance)} เมตร) ไม่สามารถกรอกฟอร์ม`;
        }
      }, error => {
        document.getElementById('status').innerText = "⚠️ ไม่สามารถดึงตำแหน่งของคุณได้ โปรดเปิด GPS และลองใหม่";
      });
    } else {
      document.getElementById('status').innerText = "❌ เบราว์เซอร์ไม่รองรับการใช้ GPS";
    }
  </script>
</body>
</html>
